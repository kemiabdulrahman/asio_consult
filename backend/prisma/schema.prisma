generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for better type safety
enum ProductCategory {
  LAPTOP
  ACCESSORY
  SOFTWARE
}

enum ServiceCategory {
  TRAINING
  SOFTWARE
  CONSULTING
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// ==================== USER MODEL ====================
model User {
  id                String    @id @default(cuid())
  email             String    @unique
  password          String    // bcrypt hashed password
  name              String?
  phone             String?
  
  // Default saved address (for faster checkout)
  defaultAddressStreet String?
  defaultAddressCity   String?
  defaultAddressState  String?
  defaultAddressZipCode String?
  defaultAddressCountry String?
  
  // Password reset
  resetToken        String?   @unique
  resetTokenExpires DateTime?
  
  // Relationships
  orders            Order[]
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([email])
  @@map("users")
}

// ==================== PRODUCT MODEL ====================
model Product {
  id          String          @id @default(cuid())
  name        String
  description String
  price       Float
  category    ProductCategory
  brand       String?
  specs       Json?
  image       String?
  inStock     Boolean         @default(true)
  quantity    Int             @default(0)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("products")
}

// ==================== SERVICE MODEL ====================
model Service {
  id          String          @id @default(cuid())
  name        String
  description String
  price       Float?
  category    ServiceCategory
  duration    String?
  features    Json?
  isActive    Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("services")
}

// ==================== CONTACT MESSAGE MODEL ====================
model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  subject   String
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("contact_messages")
}

// ==================== ADMIN MODEL ====================
model Admin {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

// ==================== ORDER MODEL ====================
model Order {
  id                    String         @id @default(cuid())
  orderNumber           String         @unique @default(cuid())
  
  // Link to customer (User is optional for guest checkout)
  userId                String?
  user                  User?          @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  // Customer Information
  customerName          String
  customerEmail         String
  customerPhone         String
  
  // Shipping Address
  shippingAddressStreet String
  shippingAddressCity   String
  shippingAddressState  String
  shippingAddressZipCode String
  shippingAddressCountry String @default("Nigeria")
  
  // Billing Address (optional)
  billingAddressStreet  String?
  billingAddressCity    String?
  billingAddressState   String?
  billingAddressZipCode String?
  billingAddressCountry String?
  
  // Order Items - JSON array structure:
  // [
  //   {
  //     productId: "abc123",
  //     name: "Acer Laptop",
  //     quantity: 1,
  //     price: 500000,
  //     category: "LAPTOP"
  //   }
  // ]
  items                 Json
  subtotal              Float
  shippingCost          Float @default(0)
  tax                   Float @default(0)
  total                 Float
  
  // Payment & Tracking
  paymentStatus         PaymentStatus  @default(PENDING)
  paymentMethod         String?        // "card", "bank_transfer", "cash_on_delivery"
  transactionId         String?
  
  orderStatus           OrderStatus    @default(PENDING)
  trackingNumber        String?
  carrier               String?        // "DHL", "FedEx", "Local Courier"
  
  // Notes
  notes                 String?        // Customer delivery instructions
  adminNotes            String?        // Internal admin notes
  
  // Timestamps
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  estimatedDeliveryDate DateTime?
  deliveredAt           DateTime?

  @@index([userId])
  @@index([customerEmail])
  @@index([orderStatus])
  @@index([createdAt])
  @@map("orders")
}